!function(){function exists(t,i){1!=arguments.length&&"object"==typeof t||(i=t,t=document);var e=Sizzle(i,t)[0];return!!e}function attr(t,i,e){try{"object"!=typeof t&&(e=i,i=t,t=document);var n=Sizzle(i,t)[0];return n?e?n.getAttribute(e):n.innerHTML:null}catch(t){f(t.message+" for "+i+" -- "+e)}}function addEventToElement(t,i,e){var n;if(n=i?function(){window[v](t,F(i))}:function(){window[v](t)},w[e]||(w[e]={}),!w[e][t]){w[e][t]=n;var o=k[e],r=Sizzle(e)[0];if(k[e]=r,r&&!o)for(var a in w[e])O(r,w[e][a]);else r&&o&&O(r,n)}}function t(t,page,i,e){"object"!=typeof page&&(e=i,i=page,page=t.customData),page.categories=page.categories||[],page.categories.push({id:encodeURIComponent(i),url:encodeURIComponent(e)})};for(var i="",e="",n="6410",o="/p/cp/",r="https://ssl.micpn.com",a="MovableInkTrack",s=864e5,c=4*s,u=1095*s,h=/^anon-\d{13}-\d{1,11}$/,p=document.getElementsByTagName("script"),m=0;m<p.length;m++)if(p[m].src){var l=p[m].src.match(/(\/\/.+)\/p\/js\/\d+/);l&&(r=l[1])}var f=window.location.hash.match(/midebug/)?function(t){console.log(t)}:function(){},d=window.location.hash.match(/midebug/)?function(t){console.error(t)}:function(){},v=window[a]||"_miconv",g=window[v]||[],y=1e3,_=500;if(!g.initialized){var w={},k={},C=g.q||window._miconv||[];C.length>0&&f("Loading "+C.length+" queued events.");for(var I={},S=window.location.search.substring(1),b=S.split("&"),m=0;m<b.length;m++){var j=b[m].split("=");I[j[0]]=j[1]}var z={};if(""!==document.cookie)for(var D=document.cookie.split(";"),m=0;m<D.length;m++){var j=D[m].replace(/^\s+|\s+$/g,"").split("=");z[j[0]]=j[1]}var U=function(){var t=(new Date).getTime(),i=Math.ceil(1e10*Math.random());return"anon-"+t.toString()+"-"+i.toString()},T=function(t){var i=function(t){for(var i=[],e=0;e<t.length;e++){var n=t[e];i.push(T(n))}return i.join("|")},e=function(t){var i=[];for(var e in t)if(t.hasOwnProperty(e)){var o=t[e];"string"==typeof o&&(o=T(o)),i.push([n(e),o].join(":"))}return i.join(",")},n=function(t){return t.replace(/[\|\,:]/g," ")};return"[object Array]"===Object.prototype.toString.call(t)?i(t):"object"==typeof t?e(t):"string"==typeof t?n(t):t},x=function(t,i,e,n){document.cookie=t+"="+i+"; expires="+new Date(e).toUTCString()+"; path="+n+";"},B=function(t,i){i=i||(new Date).getTime();var e=i+c,n=[t,i].join(":");x("_micpn",n,e,"/")},E=function(t,i){var e=(new Date).getTime()+u,n=[t,i].join("_");x("_mibhv",n,e,"/")},P=function(t){x(t,"",0,"/")},F=function(t){var i={};for(var e in t)if(t.hasOwnProperty(e))if("function"==typeof t[e])try{i[e]=t[e]()}catch(t){i.jserror=t.toString(),d(t)}else i[e]=t[e];return i},O=function(t,i){t.attachEvent?t.attachEvent("onclick",i):t.addEventListener&&t.addEventListener("click",i,!1)},K=function(){for(var t in k){var i=k[t],e=Sizzle(t)[0];if(k[t]=e,e&&!i)for(var n in w[t])O(e,w[t][n])}};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var A=function(){};A.prototype.init=function(){var t=this,o=z._micpn||i||"",r=z._mibhv||e||"",a=""===o||this.validateCampaignCookie(o),s=""===r||this.validateBehavioralCookie(r);if(!a||!s)return f("Bad campaign cookie: "+o),f("Bad behavioral cookie: "+r),this.valid=!1,void 0;this.valid=!0;var c=z._mibhv||"",u=e||"";if(""!==c&&""!==u&&this.validateBehavioralCookie(c)&&this.validateBehavioralCookie(u)){var p=this.extractBehavioralCookie(c),m=this.extractBehavioralCookie(u);h.test(p[0])&&!h.test(m[0])&&(I.mi_u=m[0])}if(this.userIdentifier=U(),this.companyId=n,this.campaignKey=-1,this.campaignTimestamp=new Date,this.cookieUser=null,this.hasCookie="false",o.indexOf(":")!==-1){var l=o.split(":");this.campaignKey=this.cleanString(l[0])||-1,this.campaignTimestamp=new Date(parseInt(l[1],10)),this.hasCookie=z._micpn?"host":"micpn"}if(r.indexOf("_")!==-1){var l=r.match(/^(.+)_(\d+)$/);this.userIdentifier=this.cleanString(l[1]),this.companyId=this.cleanString(l[2]),this.cookieUser=this.userIdentifier,this.hasCookie=z._mibhv?"host":"micpn"}I.mi_u&&(this.userIdentifier=this.cleanString(I.mi_u)),I.mi_cmp&&(this.campaignKey=this.cleanString(I.mi_cmp)),this.products=[],this.sendPageEvents(),this.currentUrl=document.location.toString(),setInterval(function(){t.currentUrl!=document.location.toString()&&(t.currentUrl=document.location.toString(),t.sendPageEvents())},y),setInterval(K,_),I.mi_cmp&&this.push("click");for(var d=0;d<C.length;d++)this.push(C[d]);f("Initialized miconv.")},A.prototype.sendPageEvents=function(){this.customData={},this.executeCustomJs(),"conversion"==this.customData.type&&this.push("conversion",this.customData),this.push("pageview",this.customData)},A.prototype.executeCustomJs=function(){var i=this,addCategory=function addCategory(page,e,n){t(i,page,e,n)};!function(page){try{}catch(t){page.jserror=t.toString(),d(t)}}(this.customData)},A.prototype.cleanString=function(t){return t.replace(/[^a-z0-9\_\.\-\@]/gi,"")},A.prototype.validateCampaignCookie=function(t){var i=/^(\w+):(\d+)/;return null!=t.match(i)},A.prototype.validateBehavioralCookie=function(t){var i=/^(.+)_(\d+)$/;return null!=t.match(i)},A.prototype.extractBehavioralCookie=function(t){var i=/^(.+)_(\d+)$/;return t.match(i).slice(1,3)},A.prototype.push=function(){if(this.valid){var t;if(t="string"==typeof arguments[0]?Array.prototype.slice.call(arguments,0):Array.prototype.slice.call(arguments[0],0),"send"===t[0])t.shift();else{if("addProduct"===t[0])return this.products.push(t[1]),void 0;if("addPromo"===t[0])return t[1]&&(t[1].promo=!0),this.products.push(t[1]),void 0}var e=t[0],n;n=void 0===t[1]?{amount:0}:"string"==typeof t[1]||"number"==typeof t[1]?{amount:t[1]}:t[1];var o=(n.amount||n.revenue||"").toString().replace(/[^0-9\.]/g,"");n.amount=parseFloat(o)||0;var r=t[2],a=this.campaignTimestamp.getTime(),s={t:(new Date).getTime(),mi_u:this.userIdentifier,mi_cid:this.companyId,page_title:document.title,referrer:document.referrer||document.referer,timezone_offset:(new Date).getTimezoneOffset(),event_type:e,conversion_id:r,cdate:a,ck:this.hasCookie,products:this.products.length?this.products:null};this.cookieUser&&h.test(this.cookieUser)&&this.cookieUser!=this.userIdentifier&&(s.link=this.cookieUser);for(var c in n)n.hasOwnProperty(c)&&(s[c]=n[c]);this.sendData(s),this.cookieUser=this.userIdentifier,this.hasCookie="host",E(this.userIdentifier,this.companyId),e.match(/^conver(sion|t)/)?P("_micpn"):I.mi_cmp?B(I.mi_cmp):z._micpn||""===i||B(this.campaignKey,this.campaignTimestamp.getTime())}},A.prototype.sendData=function(t){var i=[r,o,this.campaignKey,"/track.gif"].join(""),e=[];for(var n in t)if(t.hasOwnProperty(n)&&t[n]){var a=t[n];"string"!=typeof a&&(a=T(a));var s=[encodeURIComponent(n),encodeURIComponent(a)].join("=");e.push(s)}i+="?"+e.join("&"),f("Constructed URL: "+i),this.loadImage(i,function(){f("Pushed event: "+this.campaignKey+" : "+t.event_type+", "+i)},function(){f("Failed event: "+this.campaignKey+" : "+t.event_type+", "+i)})},A.prototype.loadImage=function(t,i,e){var n=new Image(1,1);n.onload=function(){i(),n.onload=null},n.onerror=function(){e(),n.onerror=null},n.src=t},A.setup=function(){var t=new A;window[v]=function(){t.push.apply(t,arguments)},window[v].push=window[v],window[v].initialized=!0,t.init()},A.setup()}}();
